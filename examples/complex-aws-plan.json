{
  "format_version": "1.2",
  "terraform_version": "1.6.0",
  "resource_changes": [
    {
      "address": "aws_vpc.main",
      "mode": "managed",
      "type": "aws_vpc",
      "name": "main",
      "provider_name": "registry.terraform.io/hashicorp/aws",
      "change": {
        "actions": ["no-op"],
        "before": {
          "cidr_block": "10.0.0.0/16",
          "enable_dns_hostnames": true,
          "enable_dns_support": true,
          "tags": {
            "Name": "production-vpc",
            "Environment": "production"
          }
        },
        "after": {
          "cidr_block": "10.0.0.0/16",
          "enable_dns_hostnames": true,
          "enable_dns_support": true,
          "tags": {
            "Name": "production-vpc",
            "Environment": "production"
          }
        }
      }
    },
    {
      "address": "aws_internet_gateway.main",
      "mode": "managed",
      "type": "aws_internet_gateway",
      "name": "main",
      "provider_name": "registry.terraform.io/hashicorp/aws",
      "change": {
        "actions": ["no-op"],
        "before": {
          "vpc_id": "vpc-12345678",
          "tags": {
            "Name": "production-igw"
          }
        },
        "after": {
          "vpc_id": "vpc-12345678",
          "tags": {
            "Name": "production-igw"
          }
        }
      }
    },
    {
      "address": "aws_subnet.public_az1",
      "mode": "managed",
      "type": "aws_subnet",
      "name": "public_az1",
      "provider_name": "registry.terraform.io/hashicorp/aws",
      "change": {
        "actions": ["create"],
        "before": null,
        "after": {
          "cidr_block": "10.0.1.0/24",
          "vpc_id": "vpc-12345678",
          "availability_zone": "us-east-1a",
          "map_public_ip_on_launch": true,
          "tags": {
            "Name": "public-subnet-az1",
            "Tier": "public"
          }
        }
      }
    },
    {
      "address": "aws_subnet.public_az2",
      "mode": "managed",
      "type": "aws_subnet",
      "name": "public_az2",
      "provider_name": "registry.terraform.io/hashicorp/aws",
      "change": {
        "actions": ["create"],
        "before": null,
        "after": {
          "cidr_block": "10.0.2.0/24",
          "vpc_id": "vpc-12345678",
          "availability_zone": "us-east-1b",
          "map_public_ip_on_launch": true,
          "tags": {
            "Name": "public-subnet-az2",
            "Tier": "public"
          }
        }
      }
    },
    {
      "address": "aws_subnet.private_az1",
      "mode": "managed",
      "type": "aws_subnet",
      "name": "private_az1",
      "provider_name": "registry.terraform.io/hashicorp/aws",
      "change": {
        "actions": ["no-op"],
        "before": {
          "cidr_block": "10.0.10.0/24",
          "vpc_id": "vpc-12345678",
          "availability_zone": "us-east-1a",
          "tags": {
            "Name": "private-subnet-az1",
            "Tier": "private"
          }
        },
        "after": {
          "cidr_block": "10.0.10.0/24",
          "vpc_id": "vpc-12345678",
          "availability_zone": "us-east-1a",
          "tags": {
            "Name": "private-subnet-az1",
            "Tier": "private"
          }
        }
      }
    },
    {
      "address": "aws_subnet.private_az2",
      "mode": "managed",
      "type": "aws_subnet",
      "name": "private_az2",
      "provider_name": "registry.terraform.io/hashicorp/aws",
      "change": {
        "actions": ["no-op"],
        "before": {
          "cidr_block": "10.0.11.0/24",
          "vpc_id": "vpc-12345678",
          "availability_zone": "us-east-1b",
          "tags": {
            "Name": "private-subnet-az2",
            "Tier": "private"
          }
        },
        "after": {
          "cidr_block": "10.0.11.0/24",
          "vpc_id": "vpc-12345678",
          "availability_zone": "us-east-1b",
          "tags": {
            "Name": "private-subnet-az2",
            "Tier": "private"
          }
        }
      }
    },
    {
      "address": "aws_nat_gateway.az1",
      "mode": "managed",
      "type": "aws_nat_gateway",
      "name": "az1",
      "provider_name": "registry.terraform.io/hashicorp/aws",
      "change": {
        "actions": ["create"],
        "before": null,
        "after": {
          "subnet_id": "subnet-public-az1",
          "tags": {
            "Name": "nat-gateway-az1"
          }
        }
      }
    },
    {
      "address": "aws_nat_gateway.az2",
      "mode": "managed",
      "type": "aws_nat_gateway",
      "name": "az2",
      "provider_name": "registry.terraform.io/hashicorp/aws",
      "change": {
        "actions": ["create"],
        "before": null,
        "after": {
          "subnet_id": "subnet-public-az2",
          "tags": {
            "Name": "nat-gateway-az2"
          }
        }
      }
    },
    {
      "address": "aws_lb.application",
      "mode": "managed",
      "type": "aws_lb",
      "name": "application",
      "provider_name": "registry.terraform.io/hashicorp/aws",
      "change": {
        "actions": ["create"],
        "before": null,
        "after": {
          "name": "production-alb",
          "load_balancer_type": "application",
          "internal": false,
          "subnets": ["subnet-public-az1", "subnet-public-az2"],
          "tags": {
            "Name": "production-alb",
            "Environment": "production"
          }
        }
      }
    },
    {
      "address": "aws_instance.web_az1",
      "mode": "managed",
      "type": "aws_instance",
      "name": "web_az1",
      "provider_name": "registry.terraform.io/hashicorp/aws",
      "change": {
        "actions": ["update"],
        "before": {
          "ami": "ami-0c55b159cbfafe1f0",
          "instance_type": "t3.micro",
          "subnet_id": "subnet-private-az1",
          "tags": {
            "Name": "web-server-az1",
            "Tier": "web"
          }
        },
        "after": {
          "ami": "ami-0c55b159cbfafe1f0",
          "instance_type": "t3.small",
          "subnet_id": "subnet-private-az1",
          "tags": {
            "Name": "web-server-az1",
            "Tier": "web",
            "Version": "2.0"
          }
        }
      }
    },
    {
      "address": "aws_instance.web_az2",
      "mode": "managed",
      "type": "aws_instance",
      "name": "web_az2",
      "provider_name": "registry.terraform.io/hashicorp/aws",
      "change": {
        "actions": ["create"],
        "before": null,
        "after": {
          "ami": "ami-0c55b159cbfafe1f0",
          "instance_type": "t3.small",
          "subnet_id": "subnet-private-az2",
          "tags": {
            "Name": "web-server-az2",
            "Tier": "web",
            "Version": "2.0"
          }
        }
      }
    },
    {
      "address": "aws_db_instance.primary",
      "mode": "managed",
      "type": "aws_db_instance",
      "name": "primary",
      "provider_name": "registry.terraform.io/hashicorp/aws",
      "change": {
        "actions": ["update"],
        "before": {
          "identifier": "production-db",
          "engine": "postgres",
          "engine_version": "13.7",
          "instance_class": "db.t3.medium",
          "allocated_storage": 100,
          "multi_az": false,
          "db_subnet_group_name": "production-db-subnet-group"
        },
        "after": {
          "identifier": "production-db",
          "engine": "postgres",
          "engine_version": "14.5",
          "instance_class": "db.t3.medium",
          "allocated_storage": 100,
          "multi_az": true,
          "db_subnet_group_name": "production-db-subnet-group"
        }
      }
    },
    {
      "address": "aws_elasticache_cluster.redis",
      "mode": "managed",
      "type": "aws_elasticache_cluster",
      "name": "redis",
      "provider_name": "registry.terraform.io/hashicorp/aws",
      "change": {
        "actions": ["create"],
        "before": null,
        "after": {
          "cluster_id": "production-redis",
          "engine": "redis",
          "node_type": "cache.t3.micro",
          "num_cache_nodes": 2,
          "subnet_group_name": "production-cache-subnet-group"
        }
      }
    },
    {
      "address": "aws_s3_bucket.assets",
      "mode": "managed",
      "type": "aws_s3_bucket",
      "name": "assets",
      "provider_name": "registry.terraform.io/hashicorp/aws",
      "change": {
        "actions": ["no-op"],
        "before": {
          "bucket": "production-assets",
          "versioning": {
            "enabled": true
          }
        },
        "after": {
          "bucket": "production-assets",
          "versioning": {
            "enabled": true
          }
        }
      }
    },
    {
      "address": "aws_s3_bucket.logs",
      "mode": "managed",
      "type": "aws_s3_bucket",
      "name": "logs",
      "provider_name": "registry.terraform.io/hashicorp/aws",
      "change": {
        "actions": ["create"],
        "before": null,
        "after": {
          "bucket": "production-logs",
          "versioning": {
            "enabled": false
          }
        }
      }
    },
    {
      "address": "aws_cloudfront_distribution.cdn",
      "mode": "managed",
      "type": "aws_cloudfront_distribution",
      "name": "cdn",
      "provider_name": "registry.terraform.io/hashicorp/aws",
      "change": {
        "actions": ["create"],
        "before": null,
        "after": {
          "enabled": true,
          "comment": "Production CDN",
          "default_cache_behavior": {
            "target_origin_id": "production-alb"
          }
        }
      }
    },
    {
      "address": "aws_route53_zone.main",
      "mode": "managed",
      "type": "aws_route53_zone",
      "name": "main",
      "provider_name": "registry.terraform.io/hashicorp/aws",
      "change": {
        "actions": ["no-op"],
        "before": {
          "name": "example.com",
          "comment": "Production DNS zone"
        },
        "after": {
          "name": "example.com",
          "comment": "Production DNS zone"
        }
      }
    },
    {
      "address": "aws_route53_record.www",
      "mode": "managed",
      "type": "aws_route53_record",
      "name": "www",
      "provider_name": "registry.terraform.io/hashicorp/aws",
      "change": {
        "actions": ["create", "delete"],
        "before": {
          "name": "www.example.com",
          "type": "A",
          "alias": {
            "name": "old-alb.amazonaws.com"
          }
        },
        "after": {
          "name": "www.example.com",
          "type": "A",
          "alias": {
            "name": "production-cdn.cloudfront.net"
          }
        }
      }
    },
    {
      "address": "aws_security_group.alb",
      "mode": "managed",
      "type": "aws_security_group",
      "name": "alb",
      "provider_name": "registry.terraform.io/hashicorp/aws",
      "change": {
        "actions": ["create"],
        "before": null,
        "after": {
          "name": "alb-security-group",
          "description": "Security group for Application Load Balancer",
          "vpc_id": "vpc-12345678",
          "ingress": [
            {
              "from_port": 80,
              "to_port": 80,
              "protocol": "tcp",
              "cidr_blocks": ["0.0.0.0/0"]
            },
            {
              "from_port": 443,
              "to_port": 443,
              "protocol": "tcp",
              "cidr_blocks": ["0.0.0.0/0"]
            }
          ]
        }
      }
    },
    {
      "address": "aws_security_group.web",
      "mode": "managed",
      "type": "aws_security_group",
      "name": "web",
      "provider_name": "registry.terraform.io/hashicorp/aws",
      "change": {
        "actions": ["update"],
        "before": {
          "name": "web-security-group",
          "description": "Security group for web servers",
          "vpc_id": "vpc-12345678",
          "ingress": [
            {
              "from_port": 80,
              "to_port": 80,
              "protocol": "tcp",
              "security_groups": ["sg-alb"]
            }
          ]
        },
        "after": {
          "name": "web-security-group",
          "description": "Security group for web servers",
          "vpc_id": "vpc-12345678",
          "ingress": [
            {
              "from_port": 80,
              "to_port": 80,
              "protocol": "tcp",
              "security_groups": ["sg-alb"]
            },
            {
              "from_port": 443,
              "to_port": 443,
              "protocol": "tcp",
              "security_groups": ["sg-alb"]
            }
          ]
        }
      }
    },
    {
      "address": "aws_security_group.database",
      "mode": "managed",
      "type": "aws_security_group",
      "name": "database",
      "provider_name": "registry.terraform.io/hashicorp/aws",
      "change": {
        "actions": ["no-op"],
        "before": {
          "name": "database-security-group",
          "description": "Security group for database",
          "vpc_id": "vpc-12345678",
          "ingress": [
            {
              "from_port": 5432,
              "to_port": 5432,
              "protocol": "tcp",
              "security_groups": ["sg-web"]
            }
          ]
        },
        "after": {
          "name": "database-security-group",
          "description": "Security group for database",
          "vpc_id": "vpc-12345678",
          "ingress": [
            {
              "from_port": 5432,
              "to_port": 5432,
              "protocol": "tcp",
              "security_groups": ["sg-web"]
            }
          ]
        }
      }
    },
    {
      "address": "aws_iam_role.ec2",
      "mode": "managed",
      "type": "aws_iam_role",
      "name": "ec2",
      "provider_name": "registry.terraform.io/hashicorp/aws",
      "change": {
        "actions": ["create"],
        "before": null,
        "after": {
          "name": "ec2-instance-role",
          "assume_role_policy": "{...}"
        }
      }
    },
    {
      "address": "aws_secretsmanager_secret.db_password",
      "mode": "managed",
      "type": "aws_secretsmanager_secret",
      "name": "db_password",
      "provider_name": "registry.terraform.io/hashicorp/aws",
      "change": {
        "actions": ["no-op"],
        "before": {
          "name": "production/database/password",
          "description": "Database password"
        },
        "after": {
          "name": "production/database/password",
          "description": "Database password"
        }
      }
    }
  ],
  "configuration": {
    "root_module": {
      "resources": [
        {
          "address": "aws_vpc.main",
          "mode": "managed",
          "type": "aws_vpc",
          "name": "main"
        },
        {
          "address": "aws_internet_gateway.main",
          "mode": "managed",
          "type": "aws_internet_gateway",
          "name": "main",
          "depends_on": ["aws_vpc.main"]
        },
        {
          "address": "aws_subnet.public_az1",
          "mode": "managed",
          "type": "aws_subnet",
          "name": "public_az1",
          "depends_on": ["aws_vpc.main"]
        },
        {
          "address": "aws_subnet.public_az2",
          "mode": "managed",
          "type": "aws_subnet",
          "name": "public_az2",
          "depends_on": ["aws_vpc.main"]
        },
        {
          "address": "aws_subnet.private_az1",
          "mode": "managed",
          "type": "aws_subnet",
          "name": "private_az1",
          "depends_on": ["aws_vpc.main"]
        },
        {
          "address": "aws_subnet.private_az2",
          "mode": "managed",
          "type": "aws_subnet",
          "name": "private_az2",
          "depends_on": ["aws_vpc.main"]
        },
        {
          "address": "aws_nat_gateway.az1",
          "mode": "managed",
          "type": "aws_nat_gateway",
          "name": "az1",
          "depends_on": ["aws_subnet.public_az1"]
        },
        {
          "address": "aws_nat_gateway.az2",
          "mode": "managed",
          "type": "aws_nat_gateway",
          "name": "az2",
          "depends_on": ["aws_subnet.public_az2"]
        },
        {
          "address": "aws_lb.application",
          "mode": "managed",
          "type": "aws_lb",
          "name": "application",
          "depends_on": ["aws_subnet.public_az1", "aws_subnet.public_az2", "aws_security_group.alb"]
        },
        {
          "address": "aws_instance.web_az1",
          "mode": "managed",
          "type": "aws_instance",
          "name": "web_az1",
          "depends_on": ["aws_subnet.private_az1", "aws_security_group.web", "aws_iam_role.ec2"]
        },
        {
          "address": "aws_instance.web_az2",
          "mode": "managed",
          "type": "aws_instance",
          "name": "web_az2",
          "depends_on": ["aws_subnet.private_az2", "aws_security_group.web", "aws_iam_role.ec2"]
        },
        {
          "address": "aws_db_instance.primary",
          "mode": "managed",
          "type": "aws_db_instance",
          "name": "primary",
          "depends_on": ["aws_subnet.private_az1", "aws_subnet.private_az2", "aws_security_group.database"]
        },
        {
          "address": "aws_elasticache_cluster.redis",
          "mode": "managed",
          "type": "aws_elasticache_cluster",
          "name": "redis",
          "depends_on": ["aws_subnet.private_az1", "aws_subnet.private_az2"]
        },
        {
          "address": "aws_s3_bucket.assets",
          "mode": "managed",
          "type": "aws_s3_bucket",
          "name": "assets"
        },
        {
          "address": "aws_s3_bucket.logs",
          "mode": "managed",
          "type": "aws_s3_bucket",
          "name": "logs"
        },
        {
          "address": "aws_cloudfront_distribution.cdn",
          "mode": "managed",
          "type": "aws_cloudfront_distribution",
          "name": "cdn",
          "depends_on": ["aws_lb.application", "aws_s3_bucket.assets"]
        },
        {
          "address": "aws_route53_zone.main",
          "mode": "managed",
          "type": "aws_route53_zone",
          "name": "main"
        },
        {
          "address": "aws_route53_record.www",
          "mode": "managed",
          "type": "aws_route53_record",
          "name": "www",
          "depends_on": ["aws_route53_zone.main", "aws_cloudfront_distribution.cdn"]
        },
        {
          "address": "aws_security_group.alb",
          "mode": "managed",
          "type": "aws_security_group",
          "name": "alb",
          "depends_on": ["aws_vpc.main"]
        },
        {
          "address": "aws_security_group.web",
          "mode": "managed",
          "type": "aws_security_group",
          "name": "web",
          "depends_on": ["aws_vpc.main"]
        },
        {
          "address": "aws_security_group.database",
          "mode": "managed",
          "type": "aws_security_group",
          "name": "database",
          "depends_on": ["aws_vpc.main"]
        },
        {
          "address": "aws_iam_role.ec2",
          "mode": "managed",
          "type": "aws_iam_role",
          "name": "ec2"
        },
        {
          "address": "aws_secretsmanager_secret.db_password",
          "mode": "managed",
          "type": "aws_secretsmanager_secret",
          "name": "db_password"
        }
      ]
    }
  }
}
